-- Dungeon data with exact level requirements
local dungeons = {
    { name = "Desert Temple", levels = {1, 5, 15}, difficulties = {"Easy", "Medium", "Hard"} },
    { name = "Winter Outpost", levels = {30, 40, 50}, difficulties = {"Easy", "Medium", "Hard"} },
    { name = "Pirate Island", levels = {60, 65}, difficulties = {"Insane", "Nightmare"} },
    { name = "King's Castle", levels = {70, 75}, difficulties = {"Insane", "Nightmare"} },
    { name = "The Underworld", levels = {80, 85}, difficulties = {"Insane", "Nightmare"} },
    { name = "Samurai Palace", levels = {90, 95}, difficulties = {"Insane", "Nightmare"} },
    { name = "The Canals", levels = {100, 105}, difficulties = {"Insane", "Nightmare"} },
    { name = "Ghastly Harbor", levels = {110, 115}, difficulties = {"Insane", "Nightmare"} },
    { name = "Steampunk Sewers", levels = {120, 125}, difficulties = {"Insane", "Nightmare"} },
    { name = "Orbital Outpost", levels = {135, 140}, difficulties = {"Insane", "Nightmare"} },
    { name = "Volcanic Chamber", levels = {150, 155}, difficulties = {"Insane", "Nightmare"} },
    { name = "Aquatic Temple", levels = {160, 165}, difficulties = {"Insane", "Nightmare"} },
    { name = "Enchanted Forest", levels = {170, 175}, difficulties = {"Insane", "Nightmare"} },
    { name = "Northern Lands", levels = {180, 185}, difficulties = {"Insane", "Nightmare"} },
    { name = "Gilded Skies", levels = {190, 195}, difficulties = {"Insane", "Nightmare"} },
    { name = "Yokai Peak", levels = {200, 205}, difficulties = {"Insane", "Nightmare"} },
    { name = "Abyssal Void", levels = {210, 221}, difficulties = {"Insane", "Nightmare"} } 
}

-- Function to find the recommended dungeon based on player level
local function getRecommendedDungeon(level)
    local recommendedDungeon = nil
    for i, dungeon in ipairs(dungeons) do
        for j, reqLevel in ipairs(dungeon.levels) do
            if level >= reqLevel then
                recommendedDungeon = { name = dungeon.name, difficulty = dungeon.difficulties[j] }
            end
        end
    end
    return recommendedDungeon
end

-- Define the AutoMakeDungeon function
function getgenv().AutoMakeDungeon()
    local player = game:GetService("Players").LocalPlayer
    local head = player.Character and player.Character:FindFirstChild("Head")

    if not head then
        warn("Head not found")
        return
    end

    -- Retrieve the player's level from their nameplate
    local playerNameplate = head:FindFirstChild("playerNameplate")
    if not playerNameplate then
        warn("playerNameplate not found")
        return
    end

    local levelTextLabel = playerNameplate:FindFirstChild("Level")
    if not levelTextLabel then
        warn("Level TextLabel not found")
        return
    end

    local playerLevel = tonumber(levelTextLabel.Text)
    if not playerLevel then
        warn("Unable to determine player level.")
        return
    end

    -- Determine the recommended dungeon
    local dungeonInfo = getRecommendedDungeon(playerLevel)
    if not dungeonInfo then
        print("No suitable dungeon found for your level.")
        return
    end

    local dungeonName = dungeonInfo.name
    local difficulty = dungeonInfo.difficulty

    -- Execute the dungeon creation and start process
    print("Recommended Dungeon: " .. dungeonName .. " (" .. difficulty .. ")")

    -- Create and start the recommended dungeon
    local createPartyArgs = {
        [1] = {
            [1] = {
                [1] = "\1",
                [2] = {
                    ["\3"] = "CreateParty",
                    ["partyData"] = {
                        ["difficulty"] = difficulty,
                        ["minimumJoinLevel"] = playerLevel,
                        ["tier"] = 1,
                        ["visibility"] = "Public",
                        ["mode"] = "Normal",
                        ["dungeonName"] = tostring(dungeonName),
                        ["maxPlayers"] = 40
                    }
                }
            },
            [2] = "5"
        }
    }
    game:GetService("ReplicatedStorage").dataRemoteEvent:FireServer(unpack(createPartyArgs))

    wait(2)

    local startPartyArgs = {
        [1] = {
            [1] = {
                [1] = "\1",
                [2] = {
                    ["\3"] = "StartParty"
                }
            },
            [2] = "5"
        }
    }
    game:GetService("ReplicatedStorage").dataRemoteEvent:FireServer(unpack(startPartyArgs))

    print("Dungeon started successfully.")
end

-- Check for AutoMenu functionality
if getgenv().AutoMenu then    
    -- Execute various server calls
    local args = {
        [1] = {
            [1] = {
                [1] = "\1"
            },
            [2] = "2"
        }
    }
    game:GetService("ReplicatedStorage").dataRemoteEvent:FireServer(unpack(args))
    wait(1.5)

    local args = {
        [1] = {
            [1] = "ui",
            [2] = "LeaderboardGui"
        }
    }
    game:GetService("ReplicatedStorage").Utility.AssetRequester.Remote:InvokeServer(unpack(args))

    local args = { [1] = "GetWeapons" }
    game:GetService("ReplicatedStorage").remotes.getData:InvokeServer(unpack(args))
    game:GetService("ReplicatedStorage").remotes.reloadInvy:InvokeServer()

    local args = { [1] = "Desert Temple" }
    game:GetService("ReplicatedStorage").remotes.getDungeonStats:InvokeServer(unpack(args))

    local args = {
        [1] = {
            [1] = {
                [1] = "\1",
                [2] = {
                    ["\3"] = "select",
                    ["characterIndex"] = 1
                }
            },
            [2] = "L"
        }
    }
    game:GetService("ReplicatedStorage").dataRemoteEvent:FireServer(unpack(args))   

    wait(0.9)

    -- Load and run the external script
    print("Executing The Script...")

    -- Check if the loadstring was successful
    if not success then
        print("Error loading script: ", err)
    else
        print("Script loaded successfully.")
    end
else
    print("Macro Successfully Saved and Loaded")
end

-- Check for AutoMakeDungeons functionality
if getgenv().AutoMakeDungeons then
    -- Call AutoMakeDungeon to create and start a dungeon automatically
    getgenv().AutoMakeDungeon()
end

-- Independent SolaraVersion check for script loading
if getgenv().SolaraVersion then
    loadstring(game:HttpGet("https://raw.githubusercontent.com/hen56s2/Holder/refs/heads/main/Pop"))()
else
    loadstring(game:HttpGet("https://raw.githubusercontent.com/hen56s2/221/refs/heads/main/Pop"))()
end
